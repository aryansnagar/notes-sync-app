<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link
        href="https://api.fontshare.com/v2/css?f[]=jet-brains-mono@100,101,200,201,300,301,400,401,500,501,600,601,700,701,800,801,1,2&f[]=stardom@400&f[]=synonym@200,300,400,500,600,700,1&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="index.css">
    <title>Notepad</title>
</head>

<body>
    <div>
        <textarea name="textarea" id="writing-area" placeholder="Write your note .."></textarea>
        <button id="save-button">Save</button>
    </div>
    <script type="module">
        import { createClient } from 'https://esm.sh/@supabase/supabase-js@2'
        const supabaseUrl = 'https://stajayikouabaahexxpd.supabase.co'
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InN0YWpheWlrb3VhYmFhaGV4eHBkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTA3NjA3NDQsImV4cCI6MjA2NjMzNjc0NH0.cuvqXO-0v0F2D5WCVwsoC6R3Kj_XG2MytKiC2sogQyA'
        const bucket = 'notes'
        const supabase = createClient(supabaseUrl, supabaseKey)

        document.getElementById('save-button').addEventListener('click', async () => {
            const text = document.getElementById('writing-area').value.trim()
            if (!text) return alert("Note is empty.")

            const filename = `note-${new Date().toISOString().replace(/[:.]/g, '-')}.txt`
            const file = new Blob([text], { type: 'text/plain' })

            const { error } = await supabase
                .storage
                .from(bucket)
                .upload(filename, file, {
                    cacheControl: '3600',
                    upsert: false
                })

            if (error) {
                console.error(error)
                alert('Failed to upload note.')
            } else {
                alert('Note saved successfully!')
                document.getElementById('writing-area').value = ''
            }
        })
    </script>
</body>

</html>